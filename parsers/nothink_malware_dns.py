from generic import read_plain_text
import datetime
import ConfigParser

def process(response):
    """ processes the alienvault data"""
    data=[]
    headers=['ipv4-addr','reliability','priority','description','country','city','lat-long','misc']
    feeds_conf = ConfigParser.SafeConfigParser(allow_no_value=False)
    fcfg_success = feeds_conf.read('feeds.cfg')
    
    if not fcfg_success:
        logger.error('Reaper: Could not read feeds.cfg.')
        logger.error('HINT: make sure there is a feeds configuration file in the folder')
        return
    settings={}
    settings['confidence']=feeds_conf.get('nothink_malware_dns','confidence')
    settings['impact']=feeds_conf.get('nothink_malware_dns','impact')
    settings['campaign']=feeds_conf.get('nothink_malware_dns','campaign')
    settings['type']=feeds_conf.get('nothink_malware_dns','type')
    settings['reference']=feeds_conf.get('nothink_malware_dns','reference')
    
    for row in read_plain_text(response,['fqdn']):
        date=datetime.datetime.now()
        data.append({'value':row['fqdn'],'type':'fqdn','description':settings['type'],'date':'%s' % date,'confidence':settings['confidence'],'impact':settings['impact'],'campaign':settings['campaign'],'reference':settings['reference']})
    return data